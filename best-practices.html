<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Benchmaster" href="benchmaster.html" /><link rel="prev" title="Examples" href="examples.html" />

    <meta name="generator" content="sphinx-5.3.0, furo 2022.09.29"/>
        <title>Best practices - sibench 1.1.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">sibench 1.1.4 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">sibench 1.1.4 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">sibench</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual.html">Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Best practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmaster.html">Benchmaster</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="best-practices">
<h1>Best practices<a class="headerlink" href="#best-practices" title="Permalink to this heading">#</a></h1>
<section id="cache-considerations">
<h2>Cache considerations<a class="headerlink" href="#cache-considerations" title="Permalink to this heading">#</a></h2>
<p>When doing read operations, it is vital that your working set is large enough
that the storage backend cannot fulfil requests from cache - unless of course,
cache performance  is what you are trying to benchmark!</p>
<p>The object <cite>size</cite> and <cite>count</cite> parameters determine your working set.  For
example, if you have 10,000 objects of 1M size, then your working set will be
10 GB.</p>
<p>Exactly how big your working set needs to be is dependent on the storage system
under test, and may be difficult to determine.  For instance, when benchmarking
Rados, we would need to consider not only Ceph’s own cache sizes, but also the
combined amount of cache built into all the drives in the system.</p>
<p>When in doubt, use a bigger object count.  The only downsides to using a larger
count are the possibility of running out of memory on the <code class="docutils literal notranslate"><span class="pre">sibench</span></code> nodes
themselves, and the increased amount of time it will take to clean up after the
benchmark.</p>
<p>We regularly use working sets measured in terabytes when benchamarking medium
sized clusters.</p>
</section>
<section id="throughput-isn-t-everything">
<h2>Throughput isn’t everything!<a class="headerlink" href="#throughput-isn-t-everything" title="Permalink to this heading">#</a></h2>
<p>Storage systems are not usually run at peak throughput because it can lead to
extremely long response times.  In consequence, running without bandwidth
limiting is only giving half the story: it’ll tell you what the maximum
throughput in the system might be, but it is likely to be very misleading about
the response times that the storage system is likely to give in real-world use.</p>
<p>More useful figures can often be obtained by <em>first</em> determining the peak
throughput of the system, and <em>then</em> re-running the benchmarks with the
bandwidth limited to 80 or 90 percent of the peak number.</p>
</section>
<section id="boosting-throughput">
<h2>Boosting throughput<a class="headerlink" href="#boosting-throughput" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">sibench</span></code> is inefficient with respect to the amount of load it puts on its own
nodes.  This is by design: we do not want to have to wait long for a thread to
be scheduled in order to read data that has become available.  Nor do we want to
be interrupted during a write. Both of these scenarios can have a huge effect on
the accuracy of our response time measurements, and may make them look much
worse than they really are.  In essence, we are trying to avoid benchmarking
the benchmarking system itself!</p>
<p>As a consequence, a <code class="docutils literal notranslate"><span class="pre">sibench</span></code> node only starts up as many workers as it has cores.
This is adjustable using the <code class="docutils literal notranslate"><span class="pre">--workers</span></code> option.  (A factor of 2.0 will have
twice as many workers as cores).  This may be useful if we want to determine
absolute maximum throughput, provided we don’t care about the accuracy of the
response times.</p>
<p><em>Note that sibench considers hyperthreaded cores as real cores for the purposes
of determining core counts.</em></p>
<p>Alternatively, you may also be able to boost read throughput from the <code class="docutils literal notranslate"><span class="pre">sibench</span></code>
nodes by using the <code class="docutils literal notranslate"><span class="pre">--skip-read-verification</span></code> option, which does exactly what
it suggests.</p>
<p>In general though, neither of these two options are recommended except for one
particular use case: if disabling read verification or increasing the worker
count boosts your throughput numbers, then that is an indication that more
<code class="docutils literal notranslate"><span class="pre">sibench</span></code> nodes should be added in order to benchmark at those rates whilst still
giving accurate timings.</p>
</section>
<section id="response-times">
<h2>Response times<a class="headerlink" href="#response-times" title="Permalink to this heading">#</a></h2>
<p>Whilst <code class="docutils literal notranslate"><span class="pre">sibench</span></code> will output the maximum, minimum and average response times, in
practice it is the 95%-response time - the time in which 95% of requests
complete - that is likely to be the most informative.  Maximum response times
can be thrown out by one outlier result, which in turn poisons the average.  The
95% figure (or the 99% figure if you wish to perform your own analysis) is a
better indicator of a system’s behaviour.</p>
</section>
<section id="memory-considerations">
<h2>Memory considerations<a class="headerlink" href="#memory-considerations" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">sibench</span></code> is written to use as little memory as possible.  The generators
algorithmically create each object to be written or read-and-verified on the
fly, and so objects do not need to be held in memory for longer than a single
read or write operation as they can be recreated at will.</p>
<p>The one part of <code class="docutils literal notranslate"><span class="pre">sibench</span></code> that can take a <em>lot</em> of memory is the stats gathering,
as stats are held in memory by each driver node until the completion of each
phase of a run.  At the end of each phase, the manager process collects the
stats from all the nodes and merges them.  This can be a lot of data if, say,
you are running 30 driver nodes against an NVMe cluster for a long run time.</p>
<p>A consequence of this approach is that the manager node may need a lot more
memory than the driver nodes, because it has to hold the stats of <em>all</em> of the
driver nodes in memory in order to do the merge.</p>
<p>Unfortunately, some of the Ceph native libraries used by <code class="docutils literal notranslate"><span class="pre">sibench</span></code> appear to
hold on to data for longer than would seem necessary.  This can result in large
amounts of memory being used, which can result in two undesirable outcomes:</p>
<ul class="simple">
<li><p>Swapping: if the benchmarking process needs to swap, then performance figures
are likely to be wildly wrong.</p></li>
<li><p>Process death: on Linux, the OOM Killer in the kernel will terminate processes
that take too much memory with a SIGKILL.  Since this is not a signal that can
be caught, there is no warning or error when it occurs.  (The systemd script
should start a new copy of the server immediately though, so the <code class="docutils literal notranslate"><span class="pre">sibench</span></code> node
will be usable for a new benchmark run with no further action.</p></li>
</ul>
<p>At the start of each run, <code class="docutils literal notranslate"><span class="pre">sibench</span></code> determines how much physical memory each node
has, and does some back-of-the-envelope maths to determine how much memory a
benchmark may consume in the worst case.  If the latter is within about 80% of
the former, it outputs a warning message to alert the user of possible
consequences.  However, the benchmark will try to run (and because this assumes
worst-case ceph library behaviour, it may well succeed).</p>
</section>
<section id="homogeneous-cores">
<h2>Homogeneous cores<a class="headerlink" href="#homogeneous-cores" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">sibench</span></code> divides its workload between nodes, with each taking responsibility for
reading and writing some number of objects.  The division of labour is done
purely according to how many cores each node has.  It does not attempt to
measure the performance of each server node, nor does it use some artificial
measure of performance such as BogoMIPS.  Because of this, it is important that
the nodes used as <code class="docutils literal notranslate"><span class="pre">sibench</span></code> servers be of roughly equivalent speed, at least on a
per-core basis.</p>
<p>The reason for this is that if one <code class="docutils literal notranslate"><span class="pre">sibench</span></code> server is far quicker than its peers,
then when it finishes reading its share of the objects and loops round to start
at the beginning again, the data may still be in the storage system’s caches.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="benchmaster.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Benchmaster</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="examples.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Examples</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, SoftIron
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Best practices</a><ul>
<li><a class="reference internal" href="#cache-considerations">Cache considerations</a></li>
<li><a class="reference internal" href="#throughput-isn-t-everything">Throughput isn’t everything!</a></li>
<li><a class="reference internal" href="#boosting-throughput">Boosting throughput</a></li>
<li><a class="reference internal" href="#response-times">Response times</a></li>
<li><a class="reference internal" href="#memory-considerations">Memory considerations</a></li>
<li><a class="reference internal" href="#homogeneous-cores">Homogeneous cores</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    </body>
</html>